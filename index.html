<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>חיזוי משחקי כדורגל</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      text-align: center;
      padding: 20px;
    }
    input, button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      width: 250px;
      max-width: 90vw;
    }
    #result {
      margin-top: 20px;
      font-size: 18px;
      min-height: 50px;
    }
  </style>
</head>
<body>
  <h1>חיזוי תוצאת משחק כדורגל</h1>
  <input type="text" id="homeTeam" placeholder="קבוצה ביתית באנגלית" />
  <input type="text" id="awayTeam" placeholder="קבוצה אורחת באנגלית" />
  <br />
  <button onclick="predict()">נבא תוצאה</button>
  <div id="result"></div>

  <script>
    const apiKey = "5ce9f8d068bf9962e11d192391618d53";

    async function getTeamId(teamName) {
      const res = await fetch(`https://v3.football.api-sports.io/teams?search=${encodeURIComponent(teamName)}`, {
        headers: { "x-apisports-key": apiKey }
      });
      const data = await res.json();
      return data.response[0]?.team?.id || null;
    }

    async function findUpcomingFixture(homeId, awayId) {
      const res = await fetch(`https://v3.football.api-sports.io/fixtures/headtohead?h2h=${homeId}-${awayId}`, {
        headers: { "x-apisports-key": apiKey }
      });
      const data = await res.json();
      if (!data.response.length) return null;

      const now = new Date();
      const threeDaysLater = new Date(now);
      threeDaysLater.setDate(now.getDate() + 3);

      for (const fixture of data.response) {
        const fixtureDate = new Date(fixture.fixture.date);
        if (fixtureDate >= now && fixtureDate <= threeDaysLater) {
          return fixture.fixture.id;
        }
      }
      return null;
    }

    async function getPrediction(fixtureId) {
      const res = await fetch(`https://v3.football.api-sports.io/predictions?fixture=${fixtureId}`, {
        headers: { "x-apisports-key": apiKey }
      });
      const data = await res.json();
      return data.response[0]?.predictions?.winner || null;
    }

    async function predict() {
      const homeTeam = document.getElementById("homeTeam").value.trim();
      const awayTeam = document.getElementById("awayTeam").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.textContent = "טוען...";

      if (!homeTeam || !awayTeam) {
        resultDiv.textContent = "אנא מלא את שני השדות.";
        return;
      }

      const homeId = await getTeamId(homeTeam);
      const awayId = await getTeamId(awayTeam);

      if (!homeId || !awayId) {
        resultDiv.textContent = "אחת מהקבוצות לא נמצאה, נסה שם באנגלית מדויק.";
        return;
      }

      const fixtureId = await findUpcomingFixture(homeId, awayId);
      if (!fixtureId) {
        resultDiv.textContent = "לא נמצא משחק קרוב בין הקבוצות.";
        return;
      }

      const prediction = await getPrediction(fixtureId);
      if (!prediction || !prediction.name) {
        resultDiv.textContent = "אין תחזית זמינה למשחק זה.";
      } else {
        resultDiv.innerHTML = `התחזית היא: <strong>${prediction.name}</strong> בסיכוי של ${prediction.percent || "לא ידוע"}`;
      }
    }
  </script>
</body>
</html>
